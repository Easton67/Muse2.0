@model IEnumerable<DataObjects.Song>

@{
    ViewBag.Title = "Library";
    int charLimit = 20;
}

<div class="row mx-5 row-cols- lg-10">
    @foreach (var item in Model)
    {
        <div id="library-cards-container" class="col my-4 inline w-auto">
            <div id="image-container" class="image-container" data-image-songID="@item.SongID">
                <img id="album-img" class="album-img" src="/Images/@Path.GetFileName(item.ImageFilePath)" alt="Album art for @Html.DisplayNameFor(model => model.Title) by @Html.DisplayNameFor(model => model.Artist)" data-songid="@item.SongID">
                <button id="library-play-button" class="library-play-button">
                    <img src="~/Images/play.png" />
                </button><br />
                <audio controls src="/MuseConfig/SongFiles/@Path.GetFileName(item.Mp3FilePath)" data-audio-songid="@item.SongID"></audio>
                <br />
            </div>
            <div class="mx-5 song-info-div">
                <br>
                <div class="d-inline-block" style="white-space: nowrap!important; font-size: 30px;">
                    <p>
                        @{
                            string title = item.Title.Length >= 30 ? item.Title.Substring(0, charLimit) + "..." : item.Title;
                            string album = item.Album.Length >= 30 ? item.Album.Substring(0, charLimit) + "..." : item.Album;
                            string artist = item.Artist.Length >= 30 ? item.Artist.Substring(0, charLimit) + "..." : item.Artist;
                        }
                        @title<img style="filter: invert(100%); padding-left: 4px; width: 20px; height: 16px" src="~/Images/explicit.png" />
                    </p>
                    <p>@album</p>
                    <p>@artist</p>
                </div>
            </div>
            <div class="text-right text-white">
                <p>@Html.ActionLink("Edit", "Edit", new { id = item.SongID })</p>
                <p>@Html.ActionLink("Details", "Details", new { id = item.SongID })</p>
                <p>@Html.ActionLink("Delete", "Delete", new { id = item.SongID })</p>
            </div>
        </div>
    }
</div>
<script>
    document.querySelectorAll(".album-img").forEach(function (img) {
        // adding a click event to each image
        img.addEventListener("click", function () {
            // goes to the location of the song/details/songID
            window.location.href = "/Song/Details/" + this.getAttribute("data-songid");
        });
    });

    document.querySelectorAll(".library-play-button").forEach(function (button) {
        button.addEventListener("click", function () {
            var playorpauseimg = this.querySelector("img");
            if (playorpauseimg.src.endsWith("pause.png")) {
                // going from the button to the parent div, find the audio and pause it
                this.parentNode.querySelector("audio").pause();
                this.parentNode.querySelector("button").querySelector("img").src = "/Images/play.png";
            } else {
                this.parentNode.querySelector("audio").play();
                this.parentNode.querySelector("button").querySelector("img").src = "/Images/pause.png";
            }
        });
    });
</script>

